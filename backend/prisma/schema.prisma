generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum RolUsuario {
  ADMIN_DIRECCION
  ADMIN_RRHH
  EMPLEADO
}

enum EstadoLaboral {
  ACTIVO
  SUSPENDIDO
  FINIQUITADO
}

enum TipoDocumento {
  CONTRATO
  ANEXO
  LIQUIDACION
  ESTUDIO
  LEGAL
  CAPACITACION
  MANUAL
  CONSENTIMIENTO
  CERTIFICADO
  OTRO
}

enum VisibilidadDocumento {
  SOLO_ADMIN
  ADMIN_Y_EMPLEADO
}

enum TipoSolicitudVacaciones {
  VACACIONES
  PERMISO_DESCONTADO_DE_VACACIONES
}

enum EstadoSolicitudVacaciones {
  PENDIENTE
  APROBADA
  RECHAZADA
}

enum TipoEducacion {
  ESTUDIO
  CERTIFICACION
  CURSO
}

enum EstadoEducacion {
  EN_CURSO
  COMPLETADO
}

enum EstadoRemuneracion {
  PUBLICADA
  ANULADA
}

enum EstadoHoraExtra {
  PENDIENTE
  APROBADA
  RECHAZADA
}

enum TipoLicenciaMedica {
  ENFERMEDAD
  ACCIDENTE
  MATERNIDAD
  OTRO
}

enum TipoEventoAuditoria {
  CREACION_EMPLEADO
  CAMBIO_FECHA_INGRESO
  AJUSTE_VACACIONES
  APROBACION_VACACIONES
  RECHAZO_VACACIONES
  SUBIDA_DOCUMENTO
  DESCARGA_DOCUMENTO
  ELIMINACION_DOCUMENTO
  EDUCACION_CREATE
  EDUCACION_UPDATE
  EDUCACION_DELETE
  JOB_CREATE
  JOB_UPDATE
  JOB_DELETE
  REMUNERACION_PUBLISH
  REMUNERACION_ANULATE
  VACATION_REQUEST
  VACATION_APPROVE
  VACATION_REJECT
  VACATION_ADJUST
  VACATION_CHANGE_FECHA_INGRESO
  OVERTIME_REQUEST
  OVERTIME_APPROVE
  OVERTIME_REJECT
  REGISTRO_LICENCIA_MEDICA
  CAMBIO_ESTADO_LABORAL
  ACTUALIZACION_DATOS_PERSONALES
  RESET_PASSWORD
  INVITATION_CREATE
  INVITATION_ACCEPT
  PASSWORD_RESET_REQUEST
  PASSWORD_RESET_SUCCESS
}

model Usuario {
  id                       String                @id @default(cuid())
  rol                      RolUsuario
  email                    String                @unique
  passwordHash             String
  nombre                   String
  apellido                 String
  rut                      String                @unique
  fechaNacimiento          DateTime
  telefono                 String
  direccion                String
  fechaIngreso             DateTime
  cargo                    String
  area                     String
  jobRoleId                String?
  jobRole                  JobRole?              @relation(fields: [jobRoleId], references: [id])
  estadoLaboral            EstadoLaboral         @default(ACTIVO)
  saldoVacacionesInicial   Float?
  diasVacacionesAcumulados Float                 @default(0)
  diasVacacionesTomados    Float                 @default(0)
  urlFotoPerfil            String?
  resumenPerfilProfesional String?
  createdAt                DateTime              @default(now())
  updatedAt                DateTime              @updatedAt

  documentos               Documento[]
  educaciones              Educacion[]
  antecedentesLaborales    AntecedenteLaboral[]
  remuneraciones           Remuneracion[]
  horasExtras              HoraExtra[]
  solicitudesVacaciones    SolicitudVacaciones[] @relation("SolicitudesEmpleado")
  movimientosVacaciones    MovimientoVacaciones[]
  licenciasMedicas         LicenciaMedica[]
  eventosAuditados         EventoAuditoria[]     @relation("EventosPorUsuario")
  solicitudesAprobadas     SolicitudVacaciones[] @relation("SolicitudesAprobador")
  documentosSubidos        Documento[]           @relation("DocumentosSubidos")
  licenciasRegistradas     LicenciaMedica[]      @relation("LicenciasRegistradas")
  tokensRecuperacion       PasswordResetToken[]
  horasExtrasRevisadas     HoraExtra[]           @relation("HorasExtraRevisadas")
  invitacionesCreadas      Invitation[]          @relation("InvitationsCreatedBy")
}

model Documento {
  id                    String        @id @default(cuid())
  empleadoId            String
  empleado              Usuario       @relation(fields: [empleadoId], references: [id])
  tipoDocumento         TipoDocumento
  visibilidad           VisibilidadDocumento @default(ADMIN_Y_EMPLEADO)
  periodo               String?
  nombreArchivoOriginal String
  storagePath           String
  mimeType              String
  sizeBytes             Int
  subidoPorUsuarioId    String
  subidoPor             Usuario       @relation("DocumentosSubidos", fields: [subidoPorUsuarioId], references: [id])
  fechaSubida           DateTime      @default(now())

  educaciones           Educacion[]
  remuneraciones        Remuneracion[]
}

model Educacion {
  id           String   @id @default(cuid())
  usuarioId    String
  usuario      Usuario  @relation(fields: [usuarioId], references: [id])
  tipo         TipoEducacion
  institucion  String
  nombre       String
  fechaInicio  DateTime?
  fechaFin     DateTime?
  estado       EstadoEducacion
  descripcion  String?
  documentoId  String?
  documento    Documento? @relation(fields: [documentoId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model AntecedenteLaboral {
  id          String   @id @default(cuid())
  usuarioId   String
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  empresa     String
  cargo       String
  fechaInicio DateTime
  fechaFin    DateTime?
  descripcion String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Remuneracion {
  id          String   @id @default(cuid())
  usuarioId   String
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  periodo     String
  fechaPago   DateTime?
  montoLiquido Float?
  montoBruto  Float?
  documentoId String
  documento   Documento @relation(fields: [documentoId], references: [id])
  estado      EstadoRemuneracion
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model HoraExtra {
  id                String   @id @default(cuid())
  usuarioId         String
  usuario           Usuario  @relation(fields: [usuarioId], references: [id])
  fecha             DateTime
  horas             Float
  motivo            String?
  estado            EstadoHoraExtra
  revisadoPorId     String?
  revisadoPor       Usuario? @relation("HorasExtraRevisadas", fields: [revisadoPorId], references: [id])
  comentarioRevision String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model SolicitudVacaciones {
  id                   String                    @id @default(cuid())
  empleadoId           String
  empleado             Usuario                   @relation("SolicitudesEmpleado", fields: [empleadoId], references: [id])
  tipoSolicitud        TipoSolicitudVacaciones
  fechaInicio          DateTime
  fechaFin             DateTime
  cantidadDias         Float
  estado               EstadoSolicitudVacaciones @default(PENDIENTE)
  fechaSolicitud       DateTime                  @default(now())
  aprobadorId          String?
  aprobador            Usuario?                  @relation("SolicitudesAprobador", fields: [aprobadorId], references: [id])
  comentarioEmpleado   String?
  comentarioAprobador  String?
  fechaResolucion      DateTime?
  alertaSuperposicion  Boolean                  @default(false)
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime                 @updatedAt
}

model MovimientoVacaciones {
  id          String   @id @default(cuid())
  empleadoId  String
  empleado    Usuario  @relation(fields: [empleadoId], references: [id])
  tipo        String
  dias        Float
  detalle     String?
  createdAt   DateTime @default(now())
}

model LicenciaMedica {
  id                 String      @id @default(cuid())
  empleadoId         String
  empleado           Usuario     @relation(fields: [empleadoId], references: [id])
  fechaInicio        DateTime
  fechaFin           DateTime
  tipo               TipoLicenciaMedica
  urlArchivoLicencia String
  observaciones      String?
  creadoPorUsuarioId String
  creadoPor          Usuario     @relation("LicenciasRegistradas", fields: [creadoPorUsuarioId], references: [id])
  fechaRegistro      DateTime    @default(now())
}

model EventoAuditoria {
  id              String                @id @default(cuid())
  usuarioId       String
  usuario         Usuario               @relation("EventosPorUsuario", fields: [usuarioId], references: [id])
  tipoEvento      TipoEventoAuditoria
  entidadAfectada String
  entidadId       String
  detalle         String
  fechaEvento     DateTime              @default(now())
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  usuarioId String
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  tokenHash String
  expiresAt DateTime
  usedAt    DateTime?
  attempts  Int      @default(0)
  createdAt DateTime @default(now())

  @@index([usuarioId])
  @@index([tokenHash])
}

model JobRole {
  id          String       @id @default(cuid())
  name        String       @unique
  active      Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  usuarios    Usuario[]
  invitations Invitation[]
}

model Invitation {
  id          String   @id @default(cuid())
  email       String
  role        RolUsuario
  jobRoleId   String?
  jobRole     JobRole? @relation(fields: [jobRoleId], references: [id])
  tokenHash   String
  expiresAt   DateTime
  usedAt      DateTime?
  createdById String
  createdBy   Usuario  @relation("InvitationsCreatedBy", fields: [createdById], references: [id])
  createdAt   DateTime @default(now())

  @@index([email])
  @@index([tokenHash])
}
